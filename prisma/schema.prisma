// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


// ---------------------
//  MODEL: tb_cliente
// ---------------------
model tb_cliente {
  cd_cliente Int         @id @default(autoincrement())
  cliente    String     @db.Char(50)
  email      String     @db.Char(50)
  cpf        String?     @db.Char(14)

  tb_venda   tb_venda[]
}

// ---------------------
//  MODEL: tb_sala
// ---------------------
model tb_sala {
  cd_sala   Int         @id @default(autoincrement())
  sala      Int
  capacidade Int
  tp_sala   String      @db.Char(5)

  tb_sessao tb_sessao[]
}

// ---------------------
//  MODEL: tb_filme
// ---------------------
model tb_filme {
  cd_filme      Int       @id @default(autoincrement())
  filme         String    @db.Char(50)
  duracao       DateTime  @db.Time(0)  
  classe_etaria String    @db.Char(5)
  tp_filme      String    @db.Char(10)

  tb_sessao     tb_sessao[]
}


// ---------------------
//  MODEL: tb_sessao
// ---------------------
model tb_sessao {
  cd_sessao Int         @id @default(autoincrement())
  data_hora DateTime
  cd_filme  Int
  cd_sala   Int

  tb_filme  tb_filme    @relation(fields: [cd_filme], references: [cd_filme])
  tb_sala   tb_sala     @relation(fields: [cd_sala], references: [cd_sala])

  tb_ingresso tb_ingresso[]
  tb_assento tb_assento[]
}

// ---------------------
//  MODEL: tb_venda
// ---------------------
model tb_venda {
  nr_recibo    Int            @id @default(autoincrement())
  dt_hr_venda  DateTime
  valor_total  Decimal       @db.Decimal(6, 2)
  cd_cliente   Int
  tp_pagamento String

  tb_cliente   tb_cliente     @relation(fields: [cd_cliente], references: [cd_cliente])
  tb_ingresso  tb_ingresso[]
  rl_venda_lanche rl_venda_lanche[]
}

// ---------------------
//  MODEL: tb_ingresso
// ---------------------
model tb_ingresso {
  cd_ingresso   Int         @id @default(autoincrement())
  valor_ingresso Decimal   @db.Decimal(4,2)
  assento        String    @db.Char(3)
  tp_ingresso    String    @db.Char(10)
  cd_sessao      Int
  nr_recibo      Int

  tb_sessao      tb_sessao  @relation(fields: [cd_sessao], references: [cd_sessao])
  tb_venda       tb_venda   @relation(fields: [nr_recibo], references: [nr_recibo])
}

// ---------------------
//  MODEL: tb_lanche
// ---------------------
model tb_lanche {
  cd_lanche    Int              @id @default(autoincrement())
  lanche       String          @db.Char(50)
  valor_lanche Decimal         @db.Decimal(5,2)

  rl_venda_lanche rl_venda_lanche[]
}

// ---------------------------
//  MODEL: rl_venda_lanche
// ---------------------------
model rl_venda_lanche {
  nr_recibo    Int
  cd_lanche    Int
  quantidade   Int
  valor_parcial Decimal        @db.Decimal(5,2)

  tb_venda  tb_venda  @relation(fields: [nr_recibo], references: [nr_recibo])
  tb_lanche tb_lanche @relation(fields: [cd_lanche], references: [cd_lanche])

  @@id([nr_recibo, cd_lanche])
}

// ---------------------
//  MODEL: tb_assento
// ---------------------
model tb_assento {
  cd_assento     Int      @id @default(autoincrement())
  numero_assento String   @db.Char(5)
  ocupado        Boolean  @default(false)
  cd_sessao      Int

  tb_sessao tb_sessao @relation(fields: [cd_sessao], references: [cd_sessao])

  @@unique([cd_sessao, numero_assento]) // Impede assentos duplicados na mesma sess√£o
}

